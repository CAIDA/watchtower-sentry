{% extends "../base.html" %}

{% block content1 %}
<table border="0" cellpadding="0" cellspacing="0" width="100%">
    <tr>
        <td valign="top" align="right" class="textContent">
            <table border="0" cellpadding="0" cellspacing="0" width="100%">
                <tr>
                    <td align="center" valign="top" class="status_{{level}}">
                        {{ level.upper() }} [{{alert.name}}]
                    </td>
                </tr>
                <tr>
                    <td align="center" valign="top" class="statusValue">
                        Violation{{ 's' if len(data) != 1 else '' }}: {{ len(data) }}
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
{% end %}

{% block content2 %}
<table border="0" cellpadding="0" cellspacing="0" width="100%">
    <tr>
        <td align="center" valign="top" class="textContent">

            <b>Time:</b> {{ utils.format_time(time) }}</b> <br/>

            <b>Expression:</b> <a href="{{alert.get_graph_url()}}" target="_blank">{{ utils.break_dot_html(alert.current_query) }}</a></b> <br/>

            <b>Method:</b> {{ alert.method }}</b> <br/>

        </td>
    </tr>
    {% for i, (record, value, rule) in enumerate(data) %}
    <tr>
        <td align="center" valign="top" class="textContent">

            <b>Target{{ ' {}'.format(i + 1) if len(data) != 1 else '' }}:</b> <a href="{{alert.get_graph_url(record.target)}}" target="_blank">{{ utils.break_dot_html(record.target) }}</a></b> <br/>

            <b>Value:</b> {{ value }}</b> <br/>

            {% if rule %}
            <b>Rule:</b> {{ utils.extract_condition(rule) }}</b> <br/>

            {% for expr in filter(lambda x: isinstance(x, dict), rule['exprs']) %}
            <b>Tested history value:</b> {{ alert.convert(alert.get_value_for_expr(expr, record.target)) }}</b> <br/> {% end %}
            {% end %}

            {% if alert.history[record.target] %}
            <b>Part of history:</b> {{ [ alert.convert(v) for v in alert.history[record.target][:10] ] }} <br/> {% end %}

        </td>
    </tr>
    {% end %}
</table>
{% end %}
