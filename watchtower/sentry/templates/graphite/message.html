{% extends "../base.html" %}

{% block content1 %}
<table border="0" cellpadding="0" cellspacing="0" width="100%">
    <tr>
        <td valign="top" align="right" class="textContent">
            <table border="0" cellpadding="0" cellspacing="0" width="100%">
                <tr>
                    <td align="center" valign="top" class="status_{{level}}">
                        {{ level.upper() }} [{{alert.name}}]
                        {% if target %} - {{ target }} {% end %}
                    </td>
                </tr>
                <tr>
                    <td align="center" valign="top" class="statusValue">
                        Value: {{ alert.convert(value) }}
                    </td>
                </tr>
            </table>

        </td>
    </tr>
</table>
{% end %}

{% block content2 %}
<table border="0" cellpadding="0" cellspacing="0" width="100%">
    <tr>
        <td align="center" valign="top" class="textContent">

            <b>Time:</b> {{ alert.format_time_with_offset() }}</b> <br/>

            <b>Method:</b> {{ alert.method }}</b> <br/>

            <b>Expression:</b> {{ alert.current_query }}</b> <br/>

            {% if target %}
            <b>Target:</b> {{ target }}</b> <br/>

            {% if rule %}
            <b>Rule:</b> {{ utils.extract_condition(rule) }}</b> <br/>

            {% for expr in filter(lambda x: isinstance(x, dict), rule['exprs']) %}
            <b>Tested history value:</b> {{ alert.convert(alert.get_value_for_expr(expr, target)) }}</b> <br/> {% end %}

            {% end %}

            {% if alert.history[target] %}
            <b>History:</b> {{ [ alert.convert(v) for v in alert.history[target][:100] ] }} <br/> {% end %}

            {% end %}
        </td>
    </tr>
    <tr>
        <td align="center" valign="top" class="bottomShim">
            <table border="0" cellpadding="0" cellspacing="0" width="260" class="emailButton">
                <tr>
                    <td align="center" valign="middle" class="buttonContent">
                        <a href="{{alert.get_graph_url(target, graphite_url)}}" target="_blank">Open the graph</a>
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
{% end %}
